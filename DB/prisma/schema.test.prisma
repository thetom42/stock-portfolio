generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./test.db"
}

model User {
  USERS_ID  String     @id
  NAME      String
  SURNAME   String
  EMAIL     String     @unique
  NICKNAME  String
  PASSWORD  String
  JOIN_DATE DateTime
  portfolios Portfolio[]

  @@map("USERS")
}

model Category {
  CATEGORIES_ID String  @id
  NAME         String
  stocks       Stock[]

  @@map("CATEGORIES")
}

model Stock {
  ISIN         String    @id
  category     Category  @relation(fields: [CATEGORIES_ID], references: [CATEGORIES_ID])
  CATEGORIES_ID String
  NAME         String
  WKN          String
  SYMBOL       String
  quotes       Quote[]
  holdings     Holding[]

  @@map("STOCKS")
}

model Quote {
  QUOTES_ID   String   @id
  stock       Stock    @relation(fields: [ISIN], references: [ISIN])
  ISIN        String
  PRICE       Decimal
  CURRENCY    String
  MARKET_TIME DateTime
  EXCHANGE    String

  @@map("QUOTES")
}

model Portfolio {
  PORTFOLIOS_ID String    @id
  NAME          String
  CREATED_AT    DateTime
  user          User      @relation(fields: [USERS_ID], references: [USERS_ID])
  USERS_ID      String
  holdings      Holding[]

  @@map("PORTFOLIOS")
}

model Holding {
  HOLDINGS_ID   String       @id
  portfolio     Portfolio    @relation(fields: [PORTFOLIOS_ID], references: [PORTFOLIOS_ID])
  PORTFOLIOS_ID String
  stock         Stock        @relation(fields: [ISIN], references: [ISIN])
  ISIN          String
  QUANTITY      Int
  START_DATE    DateTime
  END_DATE      DateTime?
  transactions  Transaction[]

  @@map("HOLDINGS")
}

model Transaction {
  TRANSACTIONS_ID  String   @id
  holding          Holding  @relation(fields: [HOLDINGS_ID], references: [HOLDINGS_ID])
  HOLDINGS_ID      String
  BUY             Boolean
  TRANSACTION_TIME DateTime
  AMOUNT          Int
  PRICE           Decimal
  COMMISSION      Decimal
  BROKER          String

  @@map("TRANSACTIONS")
}
