[{"ts":1733388601380,"type":"say","say":"text","text":"@/bff/package.json @/bff/tests/setup.ts @/bff/tests/integration/ Make the integration tests run:\n\ncd bff && npm run test:integration\n\n> stock-portfolio-bff@1.0.0 test:integration\n> cd tests/integration && mocha --config .mocharc.js\n\nDetailed Keycloak Config: {\n  realm: 'stock-portfolio',\n  'auth-server-url': 'http://localhost:8080',\n  'ssl-required': 'none',\n  resource: 'bff-client',\n  credentials: { secret: '***' },\n  'confidential-port': 0,\n  'bearer-only': true,\n  'verify-token-audience': false,\n  'use-resource-role-mappings': true,\n  'enable-cors': true,\n  'full-auth-server-url': 'http://localhost:8080/realms/stock-portfolio'\n}\n\n Exception during run: Error: Missing required environment variable: DB_PASSWORD\n    at validateEnvironment (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/config/environment.ts:81:13)\n    at Object.<anonymous> (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:20:20)\n    at Module._compile (node:internal/modules/cjs/loader:1469:14)\n    at Module.m._compile (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/ts-node/src/index.ts:1618:23)\n    at Module._extensions..js (node:internal/modules/cjs/loader:1548:10)\n    at Object.require.extensions.<computed> [as .ts] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/ts-node/src/index.ts:1621:12)\n    at Module.load (node:internal/modules/cjs/loader:1288:32)\n    at Function.Module._load (node:internal/modules/cjs/loader:1104:12)\n    at Module.require (node:internal/modules/cjs/loader:1311:19)\n    at require (node:internal/modules/helpers:179:18)\n    at Object.<anonymous> (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/tests/integration/app.test.ts:6:1)\n    at Module._compile (node:internal/modules/cjs/loader:1469:14)\n    at Module.m._compile (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/ts-node/src/index.ts:1618:23)\n    at Module._extensions..js (node:internal/modules/cjs/loader:1548:10)\n    at Object.require.extensions.<computed> [as .ts] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/ts-node/src/index.ts:1621:12)\n    at Module.load (node:internal/modules/cjs/loader:1288:32)\n    at Function.Module._load (node:internal/modules/cjs/loader:1104:12)\n    at Module.require (node:internal/modules/cjs/loader:1311:19)\n    at require (node:internal/modules/helpers:179:18)\n    at Object.exports.requireOrImport (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/mocha/lib/nodejs/esm-utils.js:53:16)\n    at async Object.exports.loadFilesAsync (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/mocha/lib/nodejs/esm-utils.js:100:20)\n    at async singleRun (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/mocha/lib/cli/run-helpers.js:162:3)\n    at async Object.exports.handler (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/mocha/lib/cli/run.js:375:5)","images":[]},{"ts":1733388601385,"type":"say","say":"api_req_started","text":"{\"request\":\"<task>\\n'bff/package.json' (see below for file content) 'bff/tests/setup.ts' (see below for file content) 'bff/tests/integration/' (see below for folder content) Make the integration tests run:\\n\\ncd bff && npm run test:integration\\n\\n> stock-portfolio-bff@1.0.0 test:integration\\n> cd tests/integration && mocha --config .mocharc.js\\n\\nDetailed Keycloak Config: {\\n  realm: 'stock-portfolio',\\n  'auth-server-url': 'http://localhost:8080',\\n  'ssl-required': 'none',\\n  resource: 'bff-client',\\n  credentials: { secret: '***' },\\n  'confidential-port': 0,\\n  'bearer-only': true,\\n  'verify-token-audience': false,\\n  'use-resource-role-mappings': true,\\n  'enable-cors': true,\\n  'full-auth-server-url': 'http://localhost:8080/realms/stock-portfolio'\\n}\\n\\n Exception during run: Error: Missing required environment variable: DB_PASSWORD\\n    at validateEnvironment (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/config/environment.ts:81:13)\\n    at Object.<anonymous> (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:20:20)\\n    at Module._compile (node:internal/modules/cjs/loader:1469:14)\\n    at Module.m._compile (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/ts-node/src/index.ts:1618:23)\\n    at Module._extensions..js (node:internal/modules/cjs/loader:1548:10)\\n    at Object.require.extensions.<computed> [as .ts] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/ts-node/src/index.ts:1621:12)\\n    at Module.load (node:internal/modules/cjs/loader:1288:32)\\n    at Function.Module._load (node:internal/modules/cjs/loader:1104:12)\\n    at Module.require (node:internal/modules/cjs/loader:1311:19)\\n    at require (node:internal/modules/helpers:179:18)\\n    at Object.<anonymous> (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/tests/integration/app.test.ts:6:1)\\n    at Module._compile (node:internal/modules/cjs/loader:1469:14)\\n    at Module.m._compile (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/ts-node/src/index.ts:1618:23)\\n    at Module._extensions..js (node:internal/modules/cjs/loader:1548:10)\\n    at Object.require.extensions.<computed> [as .ts] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/ts-node/src/index.ts:1621:12)\\n    at Module.load (node:internal/modules/cjs/loader:1288:32)\\n    at Function.Module._load (node:internal/modules/cjs/loader:1104:12)\\n    at Module.require (node:internal/modules/cjs/loader:1311:19)\\n    at require (node:internal/modules/helpers:179:18)\\n    at Object.exports.requireOrImport (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/mocha/lib/nodejs/esm-utils.js:53:16)\\n    at async Object.exports.loadFilesAsync (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/mocha/lib/nodejs/esm-utils.js:100:20)\\n    at async singleRun (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/mocha/lib/cli/run-helpers.js:162:3)\\n    at async Object.exports.handler (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/mocha/lib/cli/run.js:375:5)\\n</task>\\n\\n<file_content path=\\\"bff/package.json\\\">\\n{\\n  \\\"name\\\": \\\"stock-portfolio-bff\\\",\\n  \\\"version\\\": \\\"1.0.0\\\",\\n  \\\"description\\\": \\\"BFF layer for Stock Portfolio application\\\",\\n  \\\"main\\\": \\\"src/app.ts\\\",\\n  \\\"scripts\\\": {\\n    \\\"start\\\": \\\"node dist/app.js\\\",\\n    \\\"dev\\\": \\\"nodemon src/app.ts\\\",\\n    \\\"build\\\": \\\"tsc\\\",\\n    \\\"test:unit\\\": \\\"npm-run-all test:unit:*\\\",\\n    \\\"test:unit:config\\\": \\\"cd tests/unit/config && mocha --config .mocharc.js\\\",\\n    \\\"test:unit:middleware\\\": \\\"cd tests/unit/middleware && mocha --config .mocharc.js\\\",\\n    \\\"test:unit:services\\\": \\\"cd tests/unit/services && mocha --config .mocharc.js\\\",\\n    \\\"test:unit:controller\\\": \\\"cd tests/unit/controllers && mocha --config .mocharc.js\\\",\\n    \\\"test:unit:utils\\\": \\\"cd tests/unit/utils && mocha --config .mocharc.js\\\",\\n    \\\"test:integration\\\": \\\"cd tests/integration && mocha --config .mocharc.js\\\",\\n    \\\"lint\\\": \\\"eslint . --ext .ts\\\",\\n    \\\"format\\\": \\\"prettier --write \\\\\\\"src/**/*.ts\\\\\\\"\\\",\\n    \\\"test:coverage\\\": \\\"nyc npm run test:unit\\\"\\n  },\\n  \\\"dependencies\\\": {\\n    \\\"@prisma/client\\\": \\\"^5.22.0\\\",\\n    \\\"cors\\\": \\\"^2.8.5\\\",\\n    \\\"dotenv\\\": \\\"^16.3.1\\\",\\n    \\\"express\\\": \\\"^4.18.2\\\",\\n    \\\"express-rate-limit\\\": \\\"^7.1.4\\\",\\n    \\\"express-session\\\": \\\"^1.18.1\\\",\\n    \\\"express-validator\\\": \\\"^7.0.1\\\",\\n    \\\"helmet\\\": \\\"^7.1.0\\\",\\n    \\\"keycloak-connect\\\": \\\"^22.0.5\\\",\\n    \\\"node-fetch\\\": \\\"^2.7.0\\\",\\n    \\\"pg\\\": \\\"^8.11.3\\\",\\n    \\\"uuid\\\": \\\"^9.0.1\\\"\\n  },\\n  \\\"devDependencies\\\": {\\n    \\\"@types/chai\\\": \\\"^4.3.11\\\",\\n    \\\"@types/chai-as-promised\\\": \\\"^7.1.8\\\",\\n    \\\"@types/chai-spies\\\": \\\"^1.0.6\\\",\\n    \\\"@types/cors\\\": \\\"^2.8.17\\\",\\n    \\\"@types/express\\\": \\\"^4.17.21\\\",\\n    \\\"@types/express-session\\\": \\\"^1.17.10\\\",\\n    \\\"@types/mocha\\\": \\\"^10.0.6\\\",\\n    \\\"@types/node\\\": \\\"^20.9.4\\\",\\n    \\\"@types/node-fetch\\\": \\\"^2.6.9\\\",\\n    \\\"@types/pg\\\": \\\"^8.10.9\\\",\\n    \\\"@types/sinon\\\": \\\"^17.0.2\\\",\\n    \\\"@types/sinon-chai\\\": \\\"^3.2.10\\\",\\n    \\\"@types/uuid\\\": \\\"^9.0.7\\\",\\n    \\\"chai\\\": \\\"^4.3.10\\\",\\n    \\\"chai-as-promised\\\": \\\"^7.1.1\\\",\\n    \\\"chai-spies\\\": \\\"^1.1.0\\\",\\n    \\\"mocha\\\": \\\"^10.2.0\\\",\\n    \\\"nodemon\\\": \\\"^3.0.1\\\",\\n    \\\"nyc\\\": \\\"^15.1.0\\\",\\n    \\\"prisma\\\": \\\"^5.6.0\\\",\\n    \\\"sinon\\\": \\\"^17.0.1\\\",\\n    \\\"sinon-chai\\\": \\\"^3.7.0\\\",\\n    \\\"ts-node\\\": \\\"^10.9.1\\\",\\n    \\\"typescript\\\": \\\"^5.3.2\\\"\\n  }\\n}\\n\\n</file_content>\\n\\n<file_content path=\\\"bff/tests/setup.ts\\\">\\nimport chai from 'chai';\\nimport chaiSpies from 'chai-spies';\\nimport chaiAsPromised from 'chai-as-promised';\\nimport sinon from 'sinon';\\nimport { createMockPrismaClient, resetMockPrismaClient } from './helpers/mockPrisma';\\nimport * as database from '../src/utils/database';\\n\\n// Initialize chai plugins\\nchai.use(chaiSpies);\\nchai.use(chaiAsPromised);\\n\\n// Make chai globally available\\n(global as any).chai = chai;\\n(global as any).expect = chai.expect;\\n\\n// Setup test environment\\nexport const mochaHooks = {\\n  beforeEach() {\\n    // Reset environment variables to test defaults\\n    process.env.NODE_ENV = 'test';\\n    process.env.PORT = '3000';\\n    process.env.DB_HOST = 'localhost';\\n    process.env.DB_PORT = '5432';\\n    process.env.DB_NAME = 'stock_portfolio_test';\\n    process.env.DB_USER = 'test_user';\\n    process.env.DB_PASSWORD = 'test_password';\\n    process.env.KEYCLOAK_CLIENT_ID = 'test-client';\\n    process.env.KEYCLOAK_CLIENT_SECRET = 'test-secret';\\n    process.env.YAHOO_FINANCE_API_KEY = 'test-api-key';\\n    process.env.JWT_SECRET = 'test-jwt-secret';\\n\\n    // Setup mock Prisma client\\n    const mockPrismaClient = createMockPrismaClient();\\n    sinon.stub(database, 'getPrismaClient').returns(mockPrismaClient);\\n  },\\n\\n  async afterEach() {\\n    // Clean up after each test\\n    const client = database.getPrismaClient();\\n    resetMockPrismaClient(client);\\n    await database.disconnectDatabase();\\n    sinon.restore();\\n    if (chaiSpies.restore) {\\n      chaiSpies.restore();\\n    }\\n  }\\n};\\n\\n// Global error handler for unhandled promise rejections\\nprocess.on('unhandledRejection', (error) => {\\n  console.error('Unhandled Promise Rejection:', error);\\n});\\n\\n</file_content>\\n\\n<folder_content path=\\\"bff/tests/integration/\\\">\\n├── .mocharc.js\\n└── app.test.ts\\n\\n<file_content path=\\\"bff/tests/integration/.mocharc.js\\\">\\nmodule.exports = {\\n  require: [\\n    'ts-node/register/transpile-only',\\n    'dotenv/config',\\n    '../setup.ts'\\n  ],\\n  extension: ['ts'],\\n  spec: [\\n    'app.test.ts'\\n  ],\\n  timeout: 10000,\\n  exit: true,\\n  ignore: ['../unit/**/*.ts']\\n};\\n\\n</file_content>\\n\\n<file_content path=\\\"bff/tests/integration/app.test.ts\\\">\\nimport 'mocha';\\nimport { expect } from 'chai';\\nimport sinon from 'sinon';\\nimport request from 'supertest';\\nimport express from 'express';\\nimport app, { server, resetTestState } from '../../src/app';\\nimport { environment } from '../../src/config/environment';\\n\\ndescribe('App Integration', () => {\\n  beforeEach(() => {\\n    resetTestState();\\n  });\\n\\n  afterEach(() => {\\n    sinon.restore();\\n  });\\n\\n  describe('Server Configuration', () => {\\n    it('should have CORS enabled', async () => {\\n      const response = await request(app)\\n        .get(`${environment.API_PREFIX}/health`)\\n        .set('Origin', environment.CORS_ORIGIN);\\n\\n      expect(response.headers['access-control-allow-origin']).to.equal(environment.CORS_ORIGIN);\\n    });\\n\\n    it('should have security headers enabled', async () => {\\n      const response = await request(app)\\n        .get(`${environment.API_PREFIX}/health`);\\n\\n      expect(response.headers).to.include.keys([\\n        'x-frame-options',\\n        'x-content-type-options',\\n        'x-xss-protection'\\n      ]);\\n    });\\n\\n    it('should parse JSON bodies', async () => {\\n      const response = await request(app)\\n        .post(`${environment.API_PREFIX}/users`)\\n        .send({ test: 'data' });\\n\\n      expect(response.status).to.not.equal(415); // Not unsupported media type\\n    });\\n  });\\n\\n  describe('Rate Limiting', () => {\\n    it('should allow requests within rate limit', async () => {\\n      const response = await request(app)\\n        .get(`${environment.API_PREFIX}/health`);\\n\\n      expect(response.status).to.not.equal(429);\\n    });\\n\\n    it('should block requests exceeding rate limit', async () => {\\n      // Skip this test in test environment since rate limiting is disabled\\n      if (environment.NODE_ENV === 'test') {\\n        expect(true).to.be.true;\\n        return;\\n      }\\n\\n      const requests = Array(environment.RATE_LIMIT_MAX_REQUESTS + 1)\\n        .fill(null)\\n        .map(() => request(app).get(`${environment.API_PREFIX}/health`));\\n\\n      const responses = await Promise.all(requests);\\n      const hasRateLimitError = responses.some(res => res.status === 429);\\n\\n      expect(hasRateLimitError).to.be.true;\\n    });\\n  });\\n\\n  describe('Health Check', () => {\\n    it('should return 200 and status info', async () => {\\n      const response = await request(app)\\n        .get(`${environment.API_PREFIX}/health`);\\n\\n      expect(response.status).to.equal(200);\\n      expect(response.body).to.have.property('status', 'ok');\\n      expect(response.body).to.have.property('timestamp');\\n      expect(response.body).to.have.property('environment', environment.NODE_ENV);\\n    });\\n  });\\n\\n  describe('Error Handling', () => {\\n    it('should handle 404 errors', async () => {\\n      const response = await request(app)\\n        .get(`${environment.API_PREFIX}/nonexistent-route`);\\n\\n      expect(response.status).to.equal(404);\\n      expect(response.body).to.have.nested.property('error.message', 'Not Found');\\n    });\\n\\n    it('should handle validation errors', async () => {\\n      const response = await request(app)\\n        .post(`${environment.API_PREFIX}/users`)\\n        .send({\\n          email: 'invalid-email',\\n          password: 'short'\\n        });\\n\\n      expect(response.status).to.equal(400);\\n      expect(response.body).to.have.nested.property('error.message', 'Validation Error');\\n    });\\n\\n    it('should handle unauthorized errors', async () => {\\n      const response = await request(app)\\n        .get(`${environment.API_PREFIX}/portfolios`);\\n\\n      expect(response.status).to.equal(401);\\n      expect(response.body).to.have.nested.property('error.message', 'Unauthorized');\\n    });\\n\\n    it('should handle internal server errors', async () => {\\n      const errorMiddleware = (req: express.Request, res: express.Response) => {\\n        throw new Error('Test error');\\n      };\\n\\n      app.get('/test-error', errorMiddleware);\\n\\n      const response = await request(app)\\n        .get('/test-error');\\n\\n      expect(response.status).to.equal(500);\\n      expect(response.body).to.have.nested.property('error.message', 'Internal Server Error');\\n    });\\n  });\\n\\n  describe('API Routes', () => {\\n    it('should mount user routes', async () => {\\n      const response = await request(app)\\n        .get(`${environment.API_PREFIX}/users/profile/me`);\\n\\n      expect(response.status).to.equal(401);\\n    });\\n\\n    it('should mount portfolio routes', async () => {\\n      const response = await request(app)\\n        .get(`${environment.API_PREFIX}/portfolios`);\\n\\n      expect(response.status).to.equal(401);\\n    });\\n\\n    it('should mount holding routes', async () => {\\n      const response = await request(app)\\n        .get(`${environment.API_PREFIX}/holdings`);\\n\\n      expect(response.status).to.equal(401);\\n    });\\n\\n    it('should mount transaction routes', async () => {\\n      const response = await request(app)\\n        .get(`${environment.API_PREFIX}/transactions`);\\n\\n      expect(response.status).to.equal(401);\\n    });\\n\\n    it('should mount quote routes', async () => {\\n      const response = await request(app)\\n        .get(`${environment.API_PREFIX}/quotes`);\\n\\n      expect(response.status).to.equal(401);\\n    });\\n\\n    it('should mount category routes', async () => {\\n      const response = await request(app)\\n        .get(`${environment.API_PREFIX}/categories`);\\n\\n      expect(response.status).to.equal(401);\\n    });\\n\\n    it('should mount stock routes', async () => {\\n      const response = await request(app)\\n        .get(`${environment.API_PREFIX}/stocks`);\\n\\n      expect(response.status).to.equal(401);\\n    });\\n  });\\n\\n  describe('Graceful Shutdown', () => {\\n    it('should handle SIGTERM signal', (done) => {\\n      const mockServer = {\\n        close: () => {\\n          done();\\n        }\\n      };\\n\\n      // @ts-ignore - Assigning to read-only variable for testing\\n      server = mockServer;\\n\\n      process.emit('SIGTERM', 'SIGTERM');\\n    });\\n  });\\n});\\n\\n</file_content>\\n</folder_content>\\n\\n<environment_details>\\n# VSCode Visible Files\\nbff/tests/integration/app.test.ts\\n\\n# VSCode Open Tabs\\nbff/package.json\\nbff/tests/integration/app.test.ts\\nbff/tests/integration/.mocharc.js\\n\\n# Current Working Directory (/Users/the/src/repos/thetom42/github/stock-portfolio) Files\\n.gitignore\\n.gitlab-ci.yml\\nCHANGELOG.md\\ndocker-compose.yaml\\nextract_cost_info.py\\npackage.json\\nREADME.md\\nbff/\\nbff/.env.sample\\nbff/.env.test\\nbff/.gitignore\\nbff/.npmignore\\nbff/design.md\\nbff/Dockerfile\\nbff/package.json\\nbff/README.md\\nbff/tsconfig.docker.json\\nbff/tsconfig.json\\nbff/prisma/\\nbff/prisma/schema.prisma\\nbff/spec/\\nbff/spec/stock-portfolio.yaml\\nbff/src/\\nbff/src/app.ts\\nbff/src/config/\\nbff/src/controllers/\\nbff/src/middleware/\\nbff/src/models/\\nbff/src/routes/\\nbff/src/services/\\nbff/src/types/\\nbff/src/utils/\\nbff/tests/\\nbff/tests/setup.ts\\nbff/tests/helpers/\\nbff/tests/integration/\\nbff/tests/postman/\\nbff/tests/unit/\\ncline/\\ncline/bff-design/\\ncline/bff-design/01-Create BFF Design Document.md\\ncline/bff-design/02-Create BFF File Structure.md\\ncline/bff-implementation/\\ncline/bff-implementation/09 Implement whole BFF layer.md\\ncline/bff-implementation/10 Write Unittests for BFF.md\\ncline/bff-implementation/11 Write missing services for BFF layer.md\\ncline/bff-implementation/12 Write missing unittests in BFF layer.md\\ncline/bff-implementation/13 Write Missing Routes, Controller, Services.md\\ncline/bff-implementation/14 Write Missing Models.md\\ncline/bff-implementation/15 Adapt Existing Unittests and Write Missing tests.md\\ncline/bff-implementation/16 Adapt Tests for HoldingService and PortfolioService.md\\ncline/bff-implementation/34 Fix Import Errors.md\\ncline/bff-implementation/36 Add Missing Methods to Holdings.md\\ncline/bff-implementation/37 Add Missing Methods to Portfolio.md\\ncline/bff-implementation/38 Fix Build Errors.md\\ncline/bff-implementation/39 Refactor the Messed Up Express Types.md\\ncline/bff-specification/\\ncline/bff-specification/18 Create Rest API Specification.md\\ncline/bff-specification/48 Review of API Specification and Improvement Suggestions.md\\ncline/bff-testing/\\ncline/bff-testing/17 Adapt Postman Collection.md\\ncline/bff-testing/18 Fix Unittest Errors.md\\ncline/bff-testing/20 Prepare for Local Debugging.md\\ncline/bff-testing/21 Fix Errors in Test Execution and in Unittests.md\\ncline/bff-testing/22 Detours and Meanders.md\\ncline/bff-testing/23 Fixing the Broken BFF Services.md\\ncline/bff-testing/24 Establish a Solid Mocking Strategy and Implement it.md\\ncline/bff-testing/25 Finish Unit Tests Step By Step Config and Middleware.md\\ncline/bff-testing/26 Finish Unit Tests Step By Step Services Part 1.md\\ncline/bff-testing/27 Finish Unit Tests Step By Step Services Part 2.md\\ncline/bff-testing/28 Finish Unit Tests Step By Step Services Part 3.md\\ncline/bff-testing/29 Finish Unit Tests Step By Step Services Fix QuoteService.md\\ncline/bff-testing/30 Finish Unix Tests Step By Step Services Last Part.md\\ncline/bff-testing/31 Finish Unit Tests Step By Step Controllers Part 1.md\\ncline/bff-testing/32 Finish Unit Tests Step By Step Controllers Part 2.md\\ncline/bff-testing/33 Finish Unit Tests Step By Step Controllers Final Part.md\\ncline/bff-testing/35 Finish Unittests Step By Step Utils.md\\ncline/bff-testing/40 Split Up Postman Collection and Add Missing routes.md\\ncline/bff-testing/41 Review Postman Collection for Categories.md\\ncline/bff-testing/42 Review Postman Collection for Holdings.md\\ncline/bff-testing/43 Review Postman Collection for Portfolios.md\\ncline/bff-testing/44 Review Postman Collection for Quotes.md\\ncline/bff-testing/45 Review Postman Collection for Stocks.md\\ncline/bff-testing/46 Review Postman Collection for Transactions.md\\ncline/bff-testing/47 Fix Issues in QuoteController unittests.md\\ncline/bff-testing/50 Make the Docker Compose Stack Work.md\\ncline/bff-testing/51 Configure BFF Port Number From Environment Variable.md\\ncline/bff-testing/52 Find Potential Issues in Postman Environment.md\\ncline/bff-testing/53 Fix Prisma OpenSSL Problem on Startup of Container.md\\ncline/bff-testing/55 Add Keycloak to Docker Compose Stack.md\\ncline/bff-testing/56 Fix launch json.md\\ncline/bff-testing/57 Local Debugging.md\\ncline/bff-testing/58 Add Token Expiration Handling to Postman Collections.md\\ncline/bff-testing/59 Fix HTTP 403 problem.md\\ncline/db-design/\\ncline/db-design/03-Create DB Design Document.md\\ncline/db-design/04-Add Plugin Pattern to DB Design.md\\ncline/db-design/05-Discussion of the DB Design.md\\ncline/db-design/06-Write the DB Design Document.md\\ncline/db-implementation/\\ncline/db-implementation/07-Unit Tests for Users & Portfolios Table.md\\ncline/db-implementation/08-Unit Tests for Remaining Entities Table.md\\ncline/db-review/\\ncline/db-review/10 DB Review.md\\ncline/db-testing/\\ncline/db-testing/49 Create More Test Data.md\\ncline/documentation/\\ncline/documentation/13 Write Project Documentation.md\\ncline/documentation/14 Write v0.1.0-alpha Release Notes.md\\ncline/documentation/19 Write v0.2.0-alpha Release Notes.md\\ncline/documentation/54 Write Presentation of Current Project Status.md\\ncline/tasks/\\ncline/tasks/1729836639295/\\ncline/tasks/1729836960268/\\ncline/tasks/1729885091850/\\ncline/tasks/1729918614614/\\ncline/tasks/1730010008397/\\ncline/tasks/1730010645474/\\ncline/tasks/1730013031088/\\ncline/tasks/1730019384211/\\ncline/tasks/1730025760185/\\ncline/tasks/1730041234789/\\ncline/tasks/1730094651221/\\ncline/tasks/1730096083817/\\ncline/tasks/1730803385599/\\ncline/tasks/1730916144255/\\ncline/tasks/1730969270552/\\ncline/tasks/1731047675784/\\ncline/tasks/1731050827112/\\ncline/tasks/1731061063818/\\ncline/tasks/1731062665619/\\ncline/tasks/1731307269574/\\ncline/tasks/1731308893468/\\ncline/tasks/1731313964431/\\ncline/tasks/1731317370304/\\ncline/tasks/1731318338321/\\ncline/tasks/1731319127474/\\ncline/tasks/1731328795798/\\ncline/tasks/1731395383528/\\ncline/tasks/1731401311266/\\ncline/tasks/1731405320301/\\ncline/tasks/1731408220443/\\ncline/tasks/1731411562433/\\ncline/tasks/1731418091102/\\ncline/tasks/1731418749564/\\ncline/tasks/1731423032827/\\ncline/tasks/1731447654467/\\ncline/tasks/1731449785026/\\ncline/tasks/1731450756556/\\ncline/tasks/1731451708336/\\ncline/tasks/1731479470588/\\ncline/tasks/1731480484677/\\ncline/tasks/1731482350000/\\ncline/tasks/1731484396502/\\ncline/tasks/1731506507797/\\ncline/tasks/1731508302434/\\ncline/tasks/1731509702261/\\ncline/tasks/1731510707946/\\ncline/tasks/1731513044264/\\ncline/tasks/1731586972899/\\ncline/tasks/1731661792680/\\ncline/tasks/1731668134044/\\ncline/tasks/1731671233690/\\ndb/\\ndb/.env.test\\ndb/design-discussions.md\\ndb/design-proposal.md\\ndb/design.md\\ndb/jest.config.js\\ndb/model.png\\ndb/package.json\\ndb/review.md\\ndb/tsconfig.json\\ndb/coverage/\\ndb/models/\\ndb/prisma/\\ndb/repositories/\\ndb/sql/\\ndb/tests/\\ndocs/\\ndocs/future-documentation-guidelines.md\\ndocs/Links.html\\ndocs/overview.jpeg\\ndocs/overview.md\\ndocs/release-v0.1.0-alpha.md\\ndocs/release-v0.2.0-alpha.md\\ndocs/trial/\\nkeycloak/\\nkeycloak/realm-export.json\\nlogs/\\nlogs/documentation-guidelines.md\\nlogs/extract-cost-chat.md\\nsamples/\\nsamples/firststeps/\\nsamples/wieruch/\\nsamples/wieruch_mongodb/\\nui/\\nui/.gitignore\\nui/.npmignore\\nui/README.md\\n\\n(File list truncated. Use list_files on specific subdirectories if you need to explore further.)\\n</environment_details>\",\"tokensIn\":0,\"tokensOut\":0,\"cacheWrites\":0,\"cacheReads\":0,\"cost\":0}"},{"ts":1733388605748,"type":"say","say":"text","text":"Looking at the error message, it seems the integration tests are failing because the required environment variable DB_PASSWORD is missing. The tests/setup.ts file shows that test environment variables are being set, but they might be getting overridden. Let's check if there's a .env.test file in the bff directory that could help.","partial":false},{"ts":1733388607528,"type":"ask","ask":"tool","text":"{\"tool\":\"readFile\",\"path\":\"bff/.env.test\",\"content\":\"/Users/the/src/repos/thetom42/github/stock-portfolio/bff/.env.test\"}","partial":false},{"ts":1733388618950,"type":"say","say":"api_req_started","text":"{\"request\":\"[read_file for 'bff/.env.test'] Result:\\n\\n# Database configuration\\nDB_HOST=localhost\\nDB_PORT=5432\\nDB_NAME=stockportfolio_test\\nDB_USER=postgres\\nDB_PASSWORD=test_password\\nDB_SSL=false\\n\\n# Server configuration\\nBFF_PORT=3001\\nINTERNAL_BFF_PORT=3000\\n\\n# Keycloak configuration\\nKEYCLOAK_AUTH_SERVER_URL=http://localhost:8080/auth\\nKEYCLOAK_REALM=stock-portfolio-test\\nKEYCLOAK_CLIENT_ID=bff-client-test\\nKEYCLOAK_CLIENT_SECRET=test_client_secret\\n\\n# Yahoo Finance API\\nYAHOO_FINANCE_API_KEY=test_api_key\\nYAHOO_FINANCE_API_HOST=yh-finance.p.rapidapi.com\\n\\n# Security\\nCORS_ORIGIN=http://localhost:4200\\nJWT_SECRET=test_jwt_secret\\nJWT_EXPIRATION=1h\\n\\n# Logging\\nLOG_LEVEL=error\\n\\n# Rate limiting\\nRATE_LIMIT_WINDOW_MS=900000\\nRATE_LIMIT_MAX_REQUESTS=100\\n\\n# Cache configuration\\nCACHE_TTL=300\\n\\n# Test environment\\nNODE_ENV=test\\n\\n# API\\nAPI_PREFIX=/api\\n\\n\\nTool [write_to_file] was not executed because a tool has already been used in this message. Only one tool may be used per message. You must assess the first tool's result before proceeding to use the next tool.\\n\\nTool [execute_command] was not executed because a tool has already been used in this message. Only one tool may be used per message. You must assess the first tool's result before proceeding to use the next tool.\\n\\nTool [read_file] was not executed because a tool has already been used in this message. Only one tool may be used per message. You must assess the first tool's result before proceeding to use the next tool.\\n\\nTool [read_file] was not executed because a tool has already been used in this message. Only one tool may be used per message. You must assess the first tool's result before proceeding to use the next tool.\\n\\nTool [write_to_file] was not executed because a tool has already been used in this message. Only one tool may be used per message. You must assess the first tool's result before proceeding to use the next tool.\\n\\nTool [write_to_file] was not executed because a tool has already been used in this message. Only one tool may be used per message. You must assess the first tool's result before proceeding to use the next tool.\\n\\nTool [write_to_file] was not executed because a tool has already been used in this message. Only one tool may be used per message. You must assess the first tool's result before proceeding to use the next tool.\\n\\n<environment_details>\\n# VSCode Visible Files\\nbff/tests/integration/app.test.ts\\n\\n# VSCode Open Tabs\\nbff/package.json\\nbff/tests/integration/app.test.ts\\nbff/tests/integration/.mocharc.js\\n</environment_details>\",\"tokensIn\":15327,\"tokensOut\":760,\"cacheWrites\":0,\"cacheReads\":0,\"cost\":0.0218739}"},{"ts":1733388622797,"type":"say","say":"text","text":"I see that bff/.env.test exists and has all the necessary environment variables. The issue might be that the environment variables aren't being loaded properly during test execution. Let's modify the setup.ts file to ensure it loads the .env.test file before any tests run.","partial":false},{"ts":1733388624304,"type":"ask","ask":"tool","text":"{\"tool\":\"editedExistingFile\",\"path\":\"bff/tests/setup.ts\",\"diff\":\"@@ -3,9 +3,14 @@\\n import chaiAsPromised from 'chai-as-promised';\\n import sinon from 'sinon';\\n import { createMockPrismaClient, resetMockPrismaClient } from './helpers/mockPrisma';\\n import * as database from '../src/utils/database';\\n+import path from 'path';\\n+import dotenv from 'dotenv';\\n \\n+// Load test environment variables\\n+dotenv.config({ path: path.join(__dirname, '../.env.test') });\\n+\\n // Initialize chai plugins\\n chai.use(chaiSpies);\\n chai.use(chaiAsPromised);\\n \\n@@ -20,15 +25,15 @@\\n     process.env.NODE_ENV = 'test';\\n     process.env.PORT = '3000';\\n     process.env.DB_HOST = 'localhost';\\n     process.env.DB_PORT = '5432';\\n-    process.env.DB_NAME = 'stock_portfolio_test';\\n-    process.env.DB_USER = 'test_user';\\n+    process.env.DB_NAME = 'stockportfolio_test';\\n+    process.env.DB_USER = 'postgres';\\n     process.env.DB_PASSWORD = 'test_password';\\n-    process.env.KEYCLOAK_CLIENT_ID = 'test-client';\\n-    process.env.KEYCLOAK_CLIENT_SECRET = 'test-secret';\\n-    process.env.YAHOO_FINANCE_API_KEY = 'test-api-key';\\n-    process.env.JWT_SECRET = 'test-jwt-secret';\\n+    process.env.KEYCLOAK_CLIENT_ID = 'bff-client-test';\\n+    process.env.KEYCLOAK_CLIENT_SECRET = 'test_client_secret';\\n+    process.env.YAHOO_FINANCE_API_KEY = 'test_api_key';\\n+    process.env.JWT_SECRET = 'test_jwt_secret';\\n \\n     // Setup mock Prisma client\\n     const mockPrismaClient = createMockPrismaClient();\\n     sinon.stub(database, 'getPrismaClient').returns(mockPrismaClient);\\n@@ -48,5 +53,5 @@\\n \\n // Global error handler for unhandled promise rejections\\n process.on('unhandledRejection', (error) => {\\n   console.error('Unhandled Promise Rejection:', error);\\n-});\\n+});\\n\\\\ No newline at end of file\\n\"}","partial":false},{"ts":1733388660790,"type":"say","say":"api_req_started","text":"{\"request\":\"[write_to_file for 'bff/tests/setup.ts'] Result:\\n\\nThe content was successfully saved to bff/tests/setup.ts.\\n\\nTool [execute_command] was not executed because a tool has already been used in this message. Only one tool may be used per message. You must assess the first tool's result before proceeding to use the next tool.\\n\\n<environment_details>\\n# VSCode Visible Files\\nbff/tests/setup.ts\\n\\n# VSCode Open Tabs\\nbff/package.json\\nbff/tests/setup.ts\\nbff/tests/integration/.mocharc.js\\n</environment_details>\",\"tokensIn\":16232,\"tokensOut\":67,\"cacheWrites\":0,\"cacheReads\":0,\"cost\":0.00900765}"},{"ts":1733388663720,"type":"say","say":"text","text":"The setup.ts file has been updated successfully. Now let's run the integration tests to see if the environment variables are properly loaded.","partial":false},{"ts":1733388663993,"type":"ask","ask":"command","text":"cd bff && npm run test:integration","partial":false},{"ts":1733388779861,"type":"say","say":"user_feedback","text":"Works! Now I the tests failed:\n\n  App Integration\n    Server Configuration\n      ✔ should have CORS enabled\n      ✔ should have security headers enabled\nAuth Error: {\n  name: 'ValidationError',\n  message: 'Validation Error',\n  stack: 'ValidationError: Validation Error\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:113:22\\n' +\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n' +\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/route.js:149:13)\\n' +\n    '    at Route.dispatch (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/route.js:119:3)\\n' +\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:284:15\\n' +\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n' +\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n' +\n    '    at Function.handle (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:175:3)\\n' +\n    '    at router (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:47:12)\\n' +\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n' +\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n' +\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n' +\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:87:5\\n' +\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n' +\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n' +\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n' +\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n' +\n    '    at session (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express-session/index.js:487:7)\\n' +\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n' +\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n' +\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n' +\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n' +\n    '    at urlencodedParser (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/types/urlencoded.js:85:7)\\n' +\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n' +\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n' +\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n' +\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/read.js:137:5\\n' +\n    '    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\\n' +\n    '    at invokeCallback (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:238:16)\\n' +\n    '    at done (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:227:7)\\n' +\n    '    at IncomingMessage.onEnd (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:287:7)\\n' +\n    '    at IncomingMessage.emit (node:events:519:28)\\n' +\n    '    at IncomingMessage.emit (node:domain:488:12)\\n' +\n    '    at endReadableNT (node:internal/streams/readable:1696:12)\\n' +\n    '    at processTicksAndRejections (node:internal/process/task_queues:82:21)',\n  code: undefined,\n  details: Error [ValidationError]: Validation Error\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:113:22\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/route.js:149:13)\n      at Route.dispatch (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/route.js:119:3)\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:284:15\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n      at Function.handle (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:175:3)\n      at router (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:47:12)\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:87:5\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n      at session (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express-session/index.js:487:7)\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n      at urlencodedParser (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/types/urlencoded.js:85:7)\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/read.js:137:5\n      at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\n      at invokeCallback (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:238:16)\n      at done (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:227:7)\n      at IncomingMessage.onEnd (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:287:7)\n      at IncomingMessage.emit (node:events:519:28)\n      at IncomingMessage.emit (node:domain:488:12)\n      at endReadableNT (node:internal/streams/readable:1696:12)\n      at processTicksAndRejections (node:internal/process/task_queues:82:21) {\n    details: [ 'Invalid email format', 'Password too short' ]\n  }\n}\n      ✔ should parse JSON bodies\n    Rate Limiting\n      ✔ should allow requests within rate limit\n      ✔ should block requests exceeding rate limit\n    Health Check\n      ✔ should return 200 and status info\n    Error Handling\n      ✔ should handle 404 errors\nAuth Error: {\n  name: 'ValidationError',\n  message: 'Validation Error',\n  stack: 'ValidationError: Validation Error\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:113:22\\n' +\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n' +\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/route.js:149:13)\\n' +\n    '    at Route.dispatch (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/route.js:119:3)\\n' +\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:284:15\\n' +\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n' +\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n' +\n    '    at Function.handle (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:175:3)\\n' +\n    '    at router (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:47:12)\\n' +\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n' +\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n' +\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n' +\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:87:5\\n' +\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n' +\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n' +\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n' +\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n' +\n    '    at session (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express-session/index.js:487:7)\\n' +\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n' +\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n' +\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n' +\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n' +\n    '    at urlencodedParser (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/types/urlencoded.js:85:7)\\n' +\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n' +\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n' +\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n' +\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/read.js:137:5\\n' +\n    '    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\\n' +\n    '    at invokeCallback (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:238:16)\\n' +\n    '    at done (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:227:7)\\n' +\n    '    at IncomingMessage.onEnd (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:287:7)\\n' +\n    '    at IncomingMessage.emit (node:events:519:28)\\n' +\n    '    at IncomingMessage.emit (node:domain:488:12)\\n' +\n    '    at endReadableNT (node:internal/streams/readable:1696:12)\\n' +\n    '    at processTicksAndRejections (node:internal/process/task_queues:82:21)',\n  code: undefined,\n  details: Error [ValidationError]: Validation Error\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:113:22\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/route.js:149:13)\n      at Route.dispatch (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/route.js:119:3)\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:284:15\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n      at Function.handle (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:175:3)\n      at router (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:47:12)\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:87:5\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n      at session (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express-session/index.js:487:7)\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n      at urlencodedParser (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/types/urlencoded.js:85:7)\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/read.js:137:5\n      at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\n      at invokeCallback (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:238:16)\n      at done (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:227:7)\n      at IncomingMessage.onEnd (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:287:7)\n      at IncomingMessage.emit (node:events:519:28)\n      at IncomingMessage.emit (node:domain:488:12)\n      at endReadableNT (node:internal/streams/readable:1696:12)\n      at processTicksAndRejections (node:internal/process/task_queues:82:21) {\n    details: [ 'Invalid email format', 'Password too short' ]\n  }\n}\n      ✔ should handle validation errors\n      ✔ should handle unauthorized errors\nAuth Error: {\n  name: 'Error',\n  message: 'Test error',\n  stack: 'Error: Test error\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:73:13\\n' +\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n' +\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n' +\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n' +\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n' +\n    '    at session (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express-session/index.js:487:7)\\n' +\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n' +\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n' +\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n' +\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n' +\n    '    at urlencodedParser (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/types/urlencoded.js:94:7)\\n' +\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n' +\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n' +\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n' +\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n' +\n    '    at jsonParser (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/types/json.js:113:7)\\n' +\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n' +\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n' +\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n' +\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n' +\n    '    at cors (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:188:7)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:224:17\\n' +\n    '    at originCallback (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:214:15)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:219:13\\n' +\n    '    at optionsCallback (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:199:9)\\n' +\n    '    at corsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:204:7)\\n' +\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n' +\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n' +\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n' +\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n' +\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:537:6)\\n' +\n    '    at xXssProtectionMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:315:3)\\n' +\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n' +\n    '    at xPoweredByMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:308:3)\\n' +\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n' +\n    '    at xPermittedCrossDomainPoliciesMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:301:3)\\n' +\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n' +\n    '    at xFrameOptionsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:285:3)\\n' +\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n' +\n    '    at xDownloadOptionsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:265:3)\\n' +\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n' +\n    '    at xDnsPrefetchControlMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:258:3)\\n' +\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n' +\n    '    at xContentTypeOptionsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:250:3)\\n' +\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n' +\n    '    at strictTransportSecurityMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:243:3)\\n' +\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n' +\n    '    at referrerPolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:211:3)\\n' +\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n' +\n    '    at originAgentClusterMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:186:3)\\n' +\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n' +\n    '    at crossOriginResourcePolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:179:3)\\n' +\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n' +\n    '    at crossOriginOpenerPolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:163:3)\\n' +\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n' +\n    '    at contentSecurityPolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:128:4)\\n' +\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n' +\n    '    at helmetMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:539:6)\\n' +\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n' +\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n' +\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n' +\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n' +\n    '    at expressInit (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/middleware/init.js:40:5)\\n' +\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n' +\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n' +\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n' +\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n' +\n    '    at query (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/middleware/query.js:45:5)\\n' +\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n' +\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n' +\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n' +\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n' +\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n' +\n    '    at Function.handle (/Users/the/src/repos/thet'... 527 more characters,\n  code: undefined,\n  details: Error: Test error\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:73:13\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n      at session (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express-session/index.js:487:7)\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n      at urlencodedParser (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/types/urlencoded.js:94:7)\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n      at jsonParser (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/types/json.js:113:7)\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n      at cors (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:188:7)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:224:17\n      at originCallback (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:214:15)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:219:13\n      at optionsCallback (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:199:9)\n      at corsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:204:7)\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:537:6)\n      at xXssProtectionMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:315:3)\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n      at xPoweredByMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:308:3)\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n      at xPermittedCrossDomainPoliciesMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:301:3)\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n      at xFrameOptionsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:285:3)\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n      at xDownloadOptionsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:265:3)\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n      at xDnsPrefetchControlMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:258:3)\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n      at xContentTypeOptionsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:250:3)\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n      at strictTransportSecurityMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:243:3)\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n      at referrerPolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:211:3)\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n      at originAgentClusterMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:186:3)\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n      at crossOriginResourcePolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:179:3)\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n      at crossOriginOpenerPolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:163:3)\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n      at contentSecurityPolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:128:4)\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n      at helmetMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:539:6)\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n      at expressInit (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/middleware/init.js:40:5)\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n      at query (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/middleware/query.js:45:5)\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n      at Function.handle (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:175:3)\n      at Function.handle (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/application.js:181:10)\n      at Server.app (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/express.js:39:9)\n      at Server.emit (node:events:519:28)\n      at Server.emit (node:domain:488:12)\n      at parserOnIncoming (node:_http_server:1140:12)\n      at HTTPParser.parserOnHeadersComplete (node:_http_common:119:17)\n}\nError: Error: Test error\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:73:13\n    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n    at session (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express-session/index.js:487:7)\n    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n    at urlencodedParser (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/types/urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n    at jsonParser (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/types/json.js:113:7)\n    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n    at cors (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:188:7)\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:224:17\n    at originCallback (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:214:15)\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:219:13\n    at optionsCallback (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:199:9)\n    at corsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:204:7)\n    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:537:6)\n    at xXssProtectionMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:315:3)\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n    at xPoweredByMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:308:3)\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n    at xPermittedCrossDomainPoliciesMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:301:3)\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n    at xFrameOptionsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:285:3)\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n    at xDownloadOptionsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:265:3)\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n    at xDnsPrefetchControlMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:258:3)\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n    at xContentTypeOptionsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:250:3)\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n    at strictTransportSecurityMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:243:3)\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n    at referrerPolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:211:3)\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n    at originAgentClusterMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:186:3)\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n    at crossOriginResourcePolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:179:3)\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n    at crossOriginOpenerPolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:163:3)\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n    at contentSecurityPolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:128:4)\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\n    at helmetMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:539:6)\n    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n    at expressInit (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/middleware/init.js:40:5)\n    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n    at query (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/middleware/query.js:45:5)\n    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\n    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\n    at Function.handle (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:175:3)\n    at Function.handle (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/application.js:181:10)\n    at Server.app (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/express.js:39:9)\n    at Server.emit (node:events:519:28)\n    at Server.emit (node:domain:488:12)\n    at parserOnIncoming (node:_http_server:1140:12)\n    at HTTPParser.parserOnHeadersComplete (node:_http_common:119:17)\n      ✔ should handle internal server errors\n    API Routes\n      ✔ should mount user routes\n      ✔ should mount portfolio routes\n      ✔ should mount holding routes\n      ✔ should mount transaction routes\n      ✔ should mount quote routes\n      ✔ should mount category routes\n      ✔ should mount stock routes\n    Graceful Shutdown\nSIGTERM signal received: closing HTTP server\n      ✔ should handle SIGTERM signal\n\n\n  18 passing (120ms)","images":[]},{"ts":1733388779870,"type":"say","say":"api_req_started","text":"{\"request\":\"[execute_command for 'cd bff && npm run test:integration'] Result:\\n\\nThe user denied this operation and provided the following feedback:\\n<feedback>\\nWorks! Now I the tests failed:\\n\\n  App Integration\\n    Server Configuration\\n      ✔ should have CORS enabled\\n      ✔ should have security headers enabled\\nAuth Error: {\\n  name: 'ValidationError',\\n  message: 'Validation Error',\\n  stack: 'ValidationError: Validation Error\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:113:22\\\\n' +\\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\\\n' +\\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/route.js:149:13)\\\\n' +\\n    '    at Route.dispatch (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/route.js:119:3)\\\\n' +\\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:284:15\\\\n' +\\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\\\n' +\\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\\\n' +\\n    '    at Function.handle (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:175:3)\\\\n' +\\n    '    at router (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:47:12)\\\\n' +\\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\\\n' +\\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\\\n' +\\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\\\n' +\\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:87:5\\\\n' +\\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\\\n' +\\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\\\n' +\\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\\\n' +\\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\\\n' +\\n    '    at session (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express-session/index.js:487:7)\\\\n' +\\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\\\n' +\\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\\\n' +\\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\\\n' +\\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\\\n' +\\n    '    at urlencodedParser (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/types/urlencoded.js:85:7)\\\\n' +\\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\\\n' +\\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\\\n' +\\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\\\n' +\\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/read.js:137:5\\\\n' +\\n    '    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\\\\n' +\\n    '    at invokeCallback (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:238:16)\\\\n' +\\n    '    at done (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:227:7)\\\\n' +\\n    '    at IncomingMessage.onEnd (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:287:7)\\\\n' +\\n    '    at IncomingMessage.emit (node:events:519:28)\\\\n' +\\n    '    at IncomingMessage.emit (node:domain:488:12)\\\\n' +\\n    '    at endReadableNT (node:internal/streams/readable:1696:12)\\\\n' +\\n    '    at processTicksAndRejections (node:internal/process/task_queues:82:21)',\\n  code: undefined,\\n  details: Error [ValidationError]: Validation Error\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:113:22\\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/route.js:149:13)\\n      at Route.dispatch (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/route.js:119:3)\\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:284:15\\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n      at Function.handle (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:175:3)\\n      at router (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:47:12)\\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:87:5\\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n      at session (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express-session/index.js:487:7)\\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n      at urlencodedParser (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/types/urlencoded.js:85:7)\\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/read.js:137:5\\n      at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\\n      at invokeCallback (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:238:16)\\n      at done (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:227:7)\\n      at IncomingMessage.onEnd (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:287:7)\\n      at IncomingMessage.emit (node:events:519:28)\\n      at IncomingMessage.emit (node:domain:488:12)\\n      at endReadableNT (node:internal/streams/readable:1696:12)\\n      at processTicksAndRejections (node:internal/process/task_queues:82:21) {\\n    details: [ 'Invalid email format', 'Password too short' ]\\n  }\\n}\\n      ✔ should parse JSON bodies\\n    Rate Limiting\\n      ✔ should allow requests within rate limit\\n      ✔ should block requests exceeding rate limit\\n    Health Check\\n      ✔ should return 200 and status info\\n    Error Handling\\n      ✔ should handle 404 errors\\nAuth Error: {\\n  name: 'ValidationError',\\n  message: 'Validation Error',\\n  stack: 'ValidationError: Validation Error\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:113:22\\\\n' +\\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\\\n' +\\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/route.js:149:13)\\\\n' +\\n    '    at Route.dispatch (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/route.js:119:3)\\\\n' +\\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:284:15\\\\n' +\\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\\\n' +\\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\\\n' +\\n    '    at Function.handle (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:175:3)\\\\n' +\\n    '    at router (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:47:12)\\\\n' +\\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\\\n' +\\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\\\n' +\\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\\\n' +\\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:87:5\\\\n' +\\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\\\n' +\\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\\\n' +\\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\\\n' +\\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\\\n' +\\n    '    at session (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express-session/index.js:487:7)\\\\n' +\\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\\\n' +\\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\\\n' +\\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\\\n' +\\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\\\n' +\\n    '    at urlencodedParser (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/types/urlencoded.js:85:7)\\\\n' +\\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\\\n' +\\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\\\n' +\\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\\\n' +\\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/read.js:137:5\\\\n' +\\n    '    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\\\\n' +\\n    '    at invokeCallback (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:238:16)\\\\n' +\\n    '    at done (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:227:7)\\\\n' +\\n    '    at IncomingMessage.onEnd (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:287:7)\\\\n' +\\n    '    at IncomingMessage.emit (node:events:519:28)\\\\n' +\\n    '    at IncomingMessage.emit (node:domain:488:12)\\\\n' +\\n    '    at endReadableNT (node:internal/streams/readable:1696:12)\\\\n' +\\n    '    at processTicksAndRejections (node:internal/process/task_queues:82:21)',\\n  code: undefined,\\n  details: Error [ValidationError]: Validation Error\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:113:22\\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/route.js:149:13)\\n      at Route.dispatch (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/route.js:119:3)\\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:284:15\\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n      at Function.handle (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:175:3)\\n      at router (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:47:12)\\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:87:5\\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n      at session (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express-session/index.js:487:7)\\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n      at urlencodedParser (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/types/urlencoded.js:85:7)\\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/read.js:137:5\\n      at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\\n      at invokeCallback (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:238:16)\\n      at done (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:227:7)\\n      at IncomingMessage.onEnd (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/raw-body/index.js:287:7)\\n      at IncomingMessage.emit (node:events:519:28)\\n      at IncomingMessage.emit (node:domain:488:12)\\n      at endReadableNT (node:internal/streams/readable:1696:12)\\n      at processTicksAndRejections (node:internal/process/task_queues:82:21) {\\n    details: [ 'Invalid email format', 'Password too short' ]\\n  }\\n}\\n      ✔ should handle validation errors\\n      ✔ should handle unauthorized errors\\nAuth Error: {\\n  name: 'Error',\\n  message: 'Test error',\\n  stack: 'Error: Test error\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:73:13\\\\n' +\\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\\\n' +\\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\\\n' +\\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\\\n' +\\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\\\n' +\\n    '    at session (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express-session/index.js:487:7)\\\\n' +\\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\\\n' +\\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\\\n' +\\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\\\n' +\\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\\\n' +\\n    '    at urlencodedParser (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/types/urlencoded.js:94:7)\\\\n' +\\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\\\n' +\\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\\\n' +\\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\\\n' +\\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\\\n' +\\n    '    at jsonParser (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/types/json.js:113:7)\\\\n' +\\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\\\n' +\\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\\\n' +\\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\\\n' +\\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\\\n' +\\n    '    at cors (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:188:7)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:224:17\\\\n' +\\n    '    at originCallback (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:214:15)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:219:13\\\\n' +\\n    '    at optionsCallback (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:199:9)\\\\n' +\\n    '    at corsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:204:7)\\\\n' +\\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\\\n' +\\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\\\n' +\\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\\\n' +\\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\\\n' +\\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:537:6)\\\\n' +\\n    '    at xXssProtectionMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:315:3)\\\\n' +\\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\\\n' +\\n    '    at xPoweredByMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:308:3)\\\\n' +\\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\\\n' +\\n    '    at xPermittedCrossDomainPoliciesMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:301:3)\\\\n' +\\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\\\n' +\\n    '    at xFrameOptionsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:285:3)\\\\n' +\\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\\\n' +\\n    '    at xDownloadOptionsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:265:3)\\\\n' +\\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\\\n' +\\n    '    at xDnsPrefetchControlMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:258:3)\\\\n' +\\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\\\n' +\\n    '    at xContentTypeOptionsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:250:3)\\\\n' +\\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\\\n' +\\n    '    at strictTransportSecurityMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:243:3)\\\\n' +\\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\\\n' +\\n    '    at referrerPolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:211:3)\\\\n' +\\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\\\n' +\\n    '    at originAgentClusterMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:186:3)\\\\n' +\\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\\\n' +\\n    '    at crossOriginResourcePolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:179:3)\\\\n' +\\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\\\n' +\\n    '    at crossOriginOpenerPolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:163:3)\\\\n' +\\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\\\n' +\\n    '    at contentSecurityPolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:128:4)\\\\n' +\\n    '    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\\\n' +\\n    '    at helmetMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:539:6)\\\\n' +\\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\\\n' +\\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\\\n' +\\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\\\n' +\\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\\\n' +\\n    '    at expressInit (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/middleware/init.js:40:5)\\\\n' +\\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\\\n' +\\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\\\n' +\\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\\\n' +\\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\\\n' +\\n    '    at query (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/middleware/query.js:45:5)\\\\n' +\\n    '    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\\\n' +\\n    '    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\\\n' +\\n    '    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\\\n' +\\n    '    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\\\n' +\\n    '    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\\\n' +\\n    '    at Function.handle (/Users/the/src/repos/thet'... 527 more characters,\\n  code: undefined,\\n  details: Error: Test error\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:73:13\\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n      at session (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express-session/index.js:487:7)\\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n      at urlencodedParser (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/types/urlencoded.js:94:7)\\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n      at jsonParser (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/types/json.js:113:7)\\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n      at cors (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:188:7)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:224:17\\n      at originCallback (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:214:15)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:219:13\\n      at optionsCallback (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:199:9)\\n      at corsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:204:7)\\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:537:6)\\n      at xXssProtectionMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:315:3)\\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n      at xPoweredByMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:308:3)\\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n      at xPermittedCrossDomainPoliciesMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:301:3)\\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n      at xFrameOptionsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:285:3)\\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n      at xDownloadOptionsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:265:3)\\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n      at xDnsPrefetchControlMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:258:3)\\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n      at xContentTypeOptionsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:250:3)\\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n      at strictTransportSecurityMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:243:3)\\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n      at referrerPolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:211:3)\\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n      at originAgentClusterMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:186:3)\\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n      at crossOriginResourcePolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:179:3)\\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n      at crossOriginOpenerPolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:163:3)\\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n      at contentSecurityPolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:128:4)\\n      at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n      at helmetMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:539:6)\\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n      at expressInit (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/middleware/init.js:40:5)\\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n      at query (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/middleware/query.js:45:5)\\n      at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n      at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n      at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n      at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n      at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n      at Function.handle (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:175:3)\\n      at Function.handle (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/application.js:181:10)\\n      at Server.app (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/express.js:39:9)\\n      at Server.emit (node:events:519:28)\\n      at Server.emit (node:domain:488:12)\\n      at parserOnIncoming (node:_http_server:1140:12)\\n      at HTTPParser.parserOnHeadersComplete (node:_http_common:119:17)\\n}\\nError: Error: Test error\\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/src/app.ts:73:13\\n    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n    at session (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express-session/index.js:487:7)\\n    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n    at urlencodedParser (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/types/urlencoded.js:94:7)\\n    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n    at jsonParser (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/body-parser/lib/types/json.js:113:7)\\n    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n    at cors (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:188:7)\\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:224:17\\n    at originCallback (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:214:15)\\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:219:13\\n    at optionsCallback (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:199:9)\\n    at corsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/cors/lib/index.js:204:7)\\n    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:537:6)\\n    at xXssProtectionMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:315:3)\\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n    at xPoweredByMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:308:3)\\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n    at xPermittedCrossDomainPoliciesMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:301:3)\\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n    at xFrameOptionsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:285:3)\\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n    at xDownloadOptionsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:265:3)\\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n    at xDnsPrefetchControlMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:258:3)\\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n    at xContentTypeOptionsMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:250:3)\\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n    at strictTransportSecurityMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:243:3)\\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n    at referrerPolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:211:3)\\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n    at originAgentClusterMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:186:3)\\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n    at crossOriginResourcePolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:179:3)\\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n    at crossOriginOpenerPolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:163:3)\\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n    at contentSecurityPolicyMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:128:4)\\n    at internalNext (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:535:6)\\n    at helmetMiddleware (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/helmet/index.cjs:539:6)\\n    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n    at expressInit (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/middleware/init.js:40:5)\\n    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n    at query (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/middleware/query.js:45:5)\\n    at Layer.handle [as handle_request] (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/layer.js:95:5)\\n    at trim_prefix (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:328:13)\\n    at /Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:286:9\\n    at Function.process_params (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:346:12)\\n    at next (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:280:10)\\n    at Function.handle (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/router/index.js:175:3)\\n    at Function.handle (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/application.js:181:10)\\n    at Server.app (/Users/the/src/repos/thetom42/github/stock-portfolio/bff/node_modules/express/lib/express.js:39:9)\\n    at Server.emit (node:events:519:28)\\n    at Server.emit (node:domain:488:12)\\n    at parserOnIncoming (node:_http_server:1140:12)\\n    at HTTPParser.parserOnHeadersComplete (node:_http_common:119:17)\\n      ✔ should handle internal server errors\\n    API Routes\\n      ✔ should mount user routes\\n      ✔ should mount portfolio routes\\n      ✔ should mount holding routes\\n      ✔ should mount transaction routes\\n      ✔ should mount quote routes\\n      ✔ should mount category routes\\n      ✔ should mount stock routes\\n    Graceful Shutdown\\nSIGTERM signal received: closing HTTP server\\n      ✔ should handle SIGTERM signal\\n\\n\\n  18 passing (120ms)\\n</feedback>\\n\\n<environment_details>\\n# VSCode Visible Files\\nbff/tests/setup.ts\\n\\n# VSCode Open Tabs\\nbff/package.json\\nbff/tests/setup.ts\\nbff/tests/integration/.mocharc.js\\n</environment_details>\",\"tokensIn\":36965,\"tokensOut\":286,\"cacheWrites\":0,\"cacheReads\":0,\"cost\":0.08691915}"},{"ts":1733388784167,"type":"say","say":"text","text":"The integration tests are now running successfully! All 18 tests have passed. The validation errors and auth errors we see in the output are actually expected behavior being tested by the test cases, such as testing error handling for invalid input and unauthorized access.\n\nLet me analyze what we did to fix the tests:\n1. We properly loaded the test environment variables by updating setup.ts to load the .env.test file\n2. The environment variables are now being correctly set in the beforeEach hook\n3. The test database connection is being properly mocked through the mockPrisma helper\n\nSince all tests are passing, we can consider this task complete.","partial":false},{"ts":1733388788452,"type":"say","say":"completion_result","text":"Integration tests are now running successfully with all 18 tests passing. The tests cover various aspects of the application including:\n- Server configuration (CORS, security headers, JSON parsing)\n- Rate limiting\n- Health check endpoint\n- Error handling (404, validation, unauthorized, internal server errors)\n- API route mounting for all major endpoints (users, portfolios, holdings, transactions, quotes, categories, stocks)\n- Graceful shutdown handling\n\nThe test environment is properly configured with mock data and database connections, allowing the tests to run independently of actual infrastructure.","partial":false},{"ts":1733388791369,"type":"ask","ask":"completion_result","text":""}]