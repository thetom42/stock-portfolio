generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./test.db"
}

model User {
  users_id   String       @id
  name       String
  surname    String
  email      String       @unique
  nickname   String
  password   String
  join_date  DateTime
  portfolios Portfolio[]

  @@map("users")
}

model Category {
  categories_id String    @id
  name         String
  stocks       Stock[]

  @@map("categories")
}

model Stock {
  isin          String      @id
  categories_id String
  name          String
  wkn           String
  symbol        String
  category      Category    @relation(fields: [categories_id], references: [categories_id])
  quotes        Quote[]
  holdings      Holding[]

  @@map("stocks")
}

model Quote {
  quotes_id    String   @id
  isin         String
  price        Decimal
  currency     String
  market_time  DateTime
  exchange     String
  stock        Stock    @relation(fields: [isin], references: [isin])

  @@map("quotes")
}

model Portfolio {
  portfolios_id String      @id
  name          String
  created_at    DateTime
  users_id      String
  user          User        @relation(fields: [users_id], references: [users_id])
  holdings      Holding[]

  @@map("portfolios")
}

model Holding {
  holdings_id   String         @id
  portfolios_id String
  isin          String
  quantity      Int
  start_date    DateTime
  end_date      DateTime?
  portfolio     Portfolio      @relation(fields: [portfolios_id], references: [portfolios_id])
  stock         Stock          @relation(fields: [isin], references: [isin])
  transactions  Transaction[]

  @@map("holdings")
}

model Transaction {
  transactions_id  String   @id
  holdings_id      String
  buy              Boolean
  transaction_time DateTime
  amount           Int
  price            Decimal
  commission       Decimal
  broker           String
  holding          Holding  @relation(fields: [holdings_id], references: [holdings_id])

  @@map("transactions")
}
